# Claude Code Guidance: bipass

This document provides essential context for working on the `bipass` codebase.

## Project Purpose

`bipass` is a command-line utility written in C to generate BIP39 mnemonic phrases for crypto wallets and simpler random-word passphrases.

## Build and Execution

- **Prerequisites:** `make`, `gcc`, `libssl-dev`.
- **Build:** Run `make`. This creates the `bipass` executable. The build process automatically generates `src/wordlist.h` from `scripts/generate_wordlist.sh`.
- **Usage:**
  - `bipass <12|15|18|21|24>`: Generate a BIP39 mnemonic.
  - `bipass --password <1-100>`: Generate a non-BIP39 passphrase.
  - `bipass --validate "<phrase>"`: Validate a BIP39 mnemonic.

## Core Architecture

The main logic is in `src/bipass.c`. The program operates in two main modes.

### 1. BIP39 Mnemonic Mode

- **Function:** `generate_mnemonic` (`src/bipass.c:32`)
- **Process:**
  1.  Reads `N` bytes of entropy from `/dev/urandom` (`generate_entropy` at `src/bipass.c:12`).
  2.  Calculates a checksum by taking the first `(word_count / 3)` bits of the SHA256 hash of the entropy (`src/bipass.c:44`).
  3.  Appends the checksum to the entropy.
  4.  Splits the resulting bits into 11-bit segments, which correspond to indices in the `wordlist` (`src/wordlist.h`).

### 2. Password Mode

- **Function:** `generate_password` (`src/bipass.c:79`)
- **Process:**
  1.  A simpler mode that does not involve a checksum.
  2.  For each requested word, it generates 16 bits of entropy from `/dev/urandom`.
  3.  Masks the 16 bits to 11 bits (`& 0x7FF`) to select a random word from the list (`src/bipass.c:85`). This is **not** suitable for crypto wallets.

### Validation

- **Function:** `validate_mnemonic` (`src/bipass.c:155`)
- **Process:** Reverses the BIP39 generation. It converts words back to their 11-bit indices, separates the entropy from the checksum, and verifies that `SHA256(entropy)` matches the provided checksum.

## Security Notes

- **Randomness:** Entropy is sourced from `/dev/urandom`, which is a strong choice.
- **Memory Management:** The tool uses `explicit_bzero()` to wipe sensitive data like entropy and the final mnemonic from memory before exiting. This is a critical security feature to prevent secrets from being exposed in memory dumps or swap. Key locations are `src/bipass.c:94` and `src/bipass.c:282`.
- **Dependencies:** Relies on OpenSSL for `SHA256`.

## Key Files

- `src/bipass.c`: Contains all generation, validation, and command-line logic.
- `src/wordlist.h`: The BIP39 English wordlist, generated by a shell script.
- `Makefile`: Defines build targets and dependencies.
- `scripts/generate_wordlist.sh`: Script to fetch the wordlist and create the header file.
